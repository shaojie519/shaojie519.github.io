
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Shaojie's Blog</title>
	<meta name="author" content="Shao jie">

	
	<meta name="description" content="May 5th, 2014 Cocoapod May 5th, 2014 IOS Cocoapods安装和使用 CocoaPods是什么 当你开发iOS应用时，会经常使用到很多第三方开源类库，比如JSONKit，AFNetWorking等等。可能某个类库又用到其他类库，所以要使用它， &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Shaojie's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://www.shaojie.name/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://s.gravatar.com/avatar/f46bfa290cab1bcbb8753835f05b302b?s=160" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">Shaojie's Blog</a></h1>
<p class="subtitle">专注移动开发Android&IOS&PHP&NODEJS</p>
<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/shaojie520" title="Weibo">Weibo</a>
		
		
		
		<a class="google" href="https://plus.google.com/+邵杰" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/shaojie519" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/shaojie519" title="GitHub">GitHub</a>
		
		
		<a class="dribbble" href="http://www.dribbble.com/shaojie" title="Dribbble">Dribbble</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-05-05T22:57:51+08:00" data-updated="true" itemprop="datePublished">May 5<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/05/05/cocoapod/" itemprop="url">Cocoapod</a></h1>
	<div class="entry-content" itemprop="articleBody">
		

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-05-05T22:44:04+08:00" data-updated="true" itemprop="datePublished">May 5<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>IOS</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/05/05/cocoapods/" itemprop="url">Cocoapods安装和使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>CocoaPods是什么</h4>

<p>当你开发iOS应用时，会经常使用到很多第三方开源类库，比如JSONKit，AFNetWorking等等。可能某个类库又用到其他类库，所以要使用它，必须得另外下载其他类库，而其他类库又用到其他类库，“子子孙孙无穷尽也”，这也许是比较特殊的情况。总之小编的意思就是，手动一个个去下载所需类库十分麻烦。另外一种常见情况是，你项目中用到的类库有更新，你必须得重新下载新版本，重新加入到项目中，十分麻烦。如果能有什么工具能解决这些恼人的问题，那将“善莫大焉”。所以，你需要 CocoaPods。</p>

<p>CocoaPods应该是iOS最常用最有名的类库管理工具了，上述两个烦人的问题，通过cocoaPods，只需要一行命令就可以完全解决，当然前提是你必须正确设置它。重要的是，绝大部分有名的开源类库，都支持CocoaPods。所以，作为iOS程序员的我们，掌握CocoaPods的使用是必不可少的基本技能了</p>

<h4>如何下载和安装CocoaPods</h4>

<p>在安装CocoaPods之前，首先要在本地安装好Ruby环境</p>

<p>假如你在本地已经安装好Ruby环境，那么下载和安装CocoaPods将十分简单，只需要一行命令。在Terminator（也就是终端）中输入以下命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo gem install cocoapods
</span><span class='line'>pod setup</span></code></pre></td></tr></table></div></figure>


<p>上面第二行执行时，会输出Setting up CocoaPods master repo，但是会等待比较久的时间。这步其实是Cocoapods在将它的信息下载到 ~/.cocoapods目录下，如果你等太久，可以试着cd到那个目录，用du -sh *来查看下载进度</p>

<p>如果你在终端中敲入这个命令之后，会发现半天没有任何反应,可以更新一下ruby的源：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem sources --remove https://rubygems.org/
</span><span class='line'>gem sources -a http://ruby.taobao.org/
</span><span class='line'>gem sources -l</span></code></pre></td></tr></table></div></figure>


<h4>如何使用CocoaPod</h4>

<ol>
<li>利用CocoaPods，在项目中导入AFNetworking类库
 AFNetworking类库在GitHub地址是：<a href="https://github.com/AFNetworking/AFNetworking">https://github.com/AFNetworking/AFNetworking</a>
为了确定AFNetworking是否支持CocoaPods，可以用CocoaPods的搜索功能验证一下。在终端中输入：</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pod search AFNetWorking</span></code></pre></td></tr></table></div></figure>


<p>过几秒钟之后，你会在终端中看到关于AFNetworking类库的一些信息</p>

<p>&#8220;
&ndash;> AFNetworking (2.2.1)
   A delightful iOS and OS X networking framework.
   pod &lsquo;AFNetworking&rsquo;, &lsquo;~> 2.2.1&rsquo;
   &ndash; Homepage: <a href="https://github.com/AFNetworking/AFNetworking">https://github.com/AFNetworking/AFNetworking</a>
   &ndash; Source:   <a href="https://github.com/AFNetworking/AFNetworking.git">https://github.com/AFNetworking/AFNetworking.git</a>
   &ndash; Versions: 2.2.1, 2.2.0, 2.1.0, 2.0.3, 2.0.2, 2.0.1, 2.0.0-RC3, 2.0.0-RC2, 2.0.0-RC1, 2.0.0, 1.3.3, 1.3.2, 1.3.1, 1.3.0, 1.2.1, 1.2.0, 1.1.0, 1.0RC3, 1.0RC2, 1.0RC1, 1.0.1, 1.0, 0.9.2, 0.9.1, 0.9.0, 0.7.0, 0.5.1, 0.10.1, 0.10.0 [master repo]
   &ndash; Sub specs:</p>

<pre><code> - AFNetworking/Serialization (2.2.1)
 - AFNetworking/Security (2.2.1)
 - AFNetworking/Reachability (2.2.1)
 - AFNetworking/NSURLConnection (2.2.1)
 - AFNetworking/NSURLSession (2.2.1)
 - AFNetworking/UIKit (2.2.1)
</code></pre>

<p>&#8220;
这说明，AFNetworking是支持CocoaPods，所以我们可以利用CocoaPods将AFNetworking导入你的项目中。
先利用Xcode创建一个项目，在项目的目录下新建一个名为Podfile的文件</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>platform :ios, '7.0'
</span><span class='line'>pod "AFNetworking", "~&gt; 2.2.0"</span></code></pre></td></tr></table></div></figure>


<p>这两句文字的意思是，当前AFNetworking支持的iOS最高版本是iOS 7.0, 要下载的AFNetworking版本是2.2.0。</p>

<p>这时候，你就可以利用CocoPods下载AFNetworking类库了。还是在终端中的当前项目目录下，运行以下命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pod install</span></code></pre></td></tr></table></div></figure>


<p>运行完成后，使用CocoaPods生成的 .xcworkspace 文件来打开工程，而不是以前的 .xcodeproj 文件
每次更改了Podfile文件，你需要重新执行一次pod install命令</p>

<h4>.gitignore</h4>

<p>当你执行pod install之后，除了Podfile外，cocoapods还会生成一个名为Podfile.lock的文件，你不应该把这个文件加入到.gitignore中。因为Podfile.lock会锁定当前各依赖库的版本，之后如果多次执行pod install 不会更改版本，要pod update才会改Podfile.lock了。这样多人协作的时候，可以防止第三方库升级把程序搞挂</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-05-01T00:20:18+08:00" data-updated="true" itemprop="datePublished">May 1<span>st</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>IOS</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/05/01/ios-sqlite/" itemprop="url">Ios Sqlite3使用</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h5>iOS中使用</h5>

<p>在 iOS 中 sqlite3 库是一套纯 C 的接口，因此很方便地就可以在 obj-c 源码中无痕使用它
首先，需要在Frameworks中加入所需的库Library   libsqlite3.0.dylib</p>

<p>这样可以导入头文件了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#import "ViewController.h"
</span><span class='line'>#import "sqlite3.h"
</span><span class='line'>#define kDatabaseName @"city.db"
</span><span class='line'>@interface ViewController (){
</span><span class='line'>      sqlite3 * database;
</span><span class='line'>}
</span><span class='line'>@end</span></code></pre></td></tr></table></div></figure>


<h4>初始化数据库</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-(BOOL)initializeDb {
</span><span class='line'>    NSLog(@"initializeDB");
</span><span class='line'>    // look to see if DB is in known location (~/Documents/$DATABASE_FILE_NAME)
</span><span class='line'>    //START:code.DatabaseShoppingList.findDocumentsDirectory
</span><span class='line'>    NSArray *searchPaths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
</span><span class='line'>    NSString *documentFolderPath = [searchPaths objectAtIndex:0];
</span><span class='line'>    //查看文件目录
</span><span class='line'>    NSLog(@"%@", documentFolderPath);
</span><span class='line'>    self.databaseFilePath = [documentFolderPath stringByAppendingPathComponent:@"city.db"];
</span><span class='line'>    
</span><span class='line'>    if(![[NSFileManager defaultManager] fileExistsAtPath:self.databaseFilePath]){
</span><span class='line'>        //didnit find db, need to copy
</span><span class='line'>        NSString *backupDbPath = [[NSBundle mainBundle] pathForResource:@"city" ofType:@"db"];
</span><span class='line'>        
</span><span class='line'>        if(backupDbPath == nil) {
</span><span class='line'>            //couldn't find backup db to copy
</span><span class='line'>            return NO;
</span><span class='line'>        }else {
</span><span class='line'>            BOOL copiedBackupDb = [[NSFileManager defaultManager] copyItemAtPath:backupDbPath toPath:self.databaseFilePath error:nil];
</span><span class='line'>            if(!copiedBackupDb){
</span><span class='line'>                return NO;
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>        
</span><span class='line'>    }
</span><span class='line'>    return TRUE;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>创建表</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-(BOOL) createTable{
</span><span class='line'>    char *sql = "CREATE TABLE city (id integer primary key, cid integer, cityName text)";
</span><span class='line'>    sqlite3_stmt *statment;
</span><span class='line'>    char *errorMsg;
</span><span class='line'>    if(sqlite3_exec(database, sql, NULL, NULL, &errorMsg) != SQLITE_OK){
</span><span class='line'>        NSLog(@"Error: create table failed %s", sqlite3_errmsg(database));
</span><span class='line'>        return NO;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    int success = sqlite3_finalize(statment);
</span><span class='line'>    if(success != SQLITE_DONE){
</span><span class='line'>        NSLog(@"failed to dehydate: %s", sqlite3_errmsg(database));
</span><span class='line'>        return NO;
</span><span class='line'>    }
</span><span class='line'>    return YES;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>向表中插入记录</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-(BOOL) insertOne{
</span><span class='line'>    char *errorMsg;
</span><span class='line'>    const char *sql = "insert into city (cid, cityName) values(101, '上海')";
</span><span class='line'>    if(sqlite3_exec(database, sql, NULL, NULL, &errorMsg) == SQLITE_OK){
</span><span class='line'>        NSLog(@"Insert ok");
</span><span class='line'>        return YES;
</span><span class='line'>    }else{
</span><span class='line'>        NSLog(@"error: %s",errorMsg);
</span><span class='line'>        sqlite3_free(errorMsg);
</span><span class='line'>        return  NO;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>查询数据库</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-(void) showCitys{
</span><span class='line'>    const char * sql = "select * from city";
</span><span class='line'>    sqlite3_stmt *statment;
</span><span class='line'>    if(sqlite3_prepare_v2(database, sql, -1, &statment, nil) == SQLITE_OK) {
</span><span class='line'>        NSLog(@"select ok.");
</span><span class='line'>    }
</span><span class='line'>    while(sqlite3_step(statment) == SQLITE_ROW) {
</span><span class='line'>        int id = sqlite3_column_int(statment, 1);
</span><span class='line'>        //char *name = (char *) sqlite3_column_text(statment, 2);
</span><span class='line'>        //直接用的char类型来中文会有乱码，使用NSString代替
</span><span class='line'>        NSString *name=[[NSString alloc] initWithCString:(char *)sqlite3_column_text(statment , 2) encoding:NSUTF8StringEncoding];
</span><span class='line'>        NSLog(@"row &gt;&gt;id %i, name %@", id, name);
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    sqlite3_finalize(statment);
</span><span class='line'>    
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>关闭数据库</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- (void)viewDidUnload {   
</span><span class='line'>    
</span><span class='line'>   sqlite3_close(database);   
</span><span class='line'>
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-24T23:06:01+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/24/android-mvp/" itemprop="url">Android MVP 模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>MVP模式与MVC模式</h4>

<p>MVP 是从经典的模式MVC演变而来，它们的基本思想有相通的地方：Controller/Presenter负责逻辑的处理，Model提供数据，View负责显示。作为一种新的模式，MVP与MVC有着一个重大的区别：在MVP中View并不直接使用Model，它们之间的通信是通过Presenter (MVC中的Controller)来进行的，所有的交互都发生在Presenter内部，而在MVC中View会从直接Model中读取数据而不是通过 Controller
<img src="http://img.hb.aicdn.com/c098e0b36a1be7bb989ca451e2f084d5758eb88b4e76-x3xslP_fw658" alt="" /></p>

<h4>什么是MVC(Model View Presenter)模式</h4>

<ol>
<li>为了使得视图接口可以与模型和控制器进行交互，控制器执行一些初始化事件</li>
<li>用户通过视图（用户接口）执行一些操作</li>
<li>控制器处理用户行为(可以用观察着模式实现)并通知模型进行更新</li>
<li>模型引发一些事件，以便将改变发告知视图</li>
<li>视图处理模型变更的事件，然后显示新的模型数据</li>
<li>用户接口等待用户的进一步操作</li>
</ol>


<h4>Example</h4>

<p>首先，我们先申明View的接口，有2个简单的方法</p>

<figure class='code'><figcaption><span>viewInterface </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">inteface</span> <span class="n">IResultsView</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">//set title</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//set result text</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showResults</span><span class="o">(</span><span class="n">String</span> <span class="n">results</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这些方法是说明我希望View中视图的变化，这里不关心它怎么发生的</p>

<p>然后再定义一个Presenter的接口</p>

<figure class='code'><figcaption><span>presenterInteface</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IResultsPresenter</span><span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在视图里（Activity/Fragemnt）里onResume()触发的时候，调用Presenter。</p>

<figure class='code'><figcaption><span>presenterInteface</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">java</span> <span class="n">ResultsPreseter</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResultsPresenter</span> <span class="kd">implements</span> <span class="n">IResultsPresenter</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">IResultsView</span> <span class="n">resultsView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">ResultsPresenter</span><span class="o">(</span><span class="n">IResultsView</span> <span class="n">resultsView</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">resultsView</span> <span class="o">=</span> <span class="n">resultsView</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Get a title</span>
</span><span class='line'>        <span class="n">getTitle</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Get results</span>
</span><span class='line'>        <span class="n">getResults</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里，会触发IResultView里定义的2个函数</p>

<figure class='code'><figcaption><span>presenterInteface</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FragmentResults</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="kd">implements</span> <span class="n">IResultsView</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">View</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">title</span><span class="o">,</span> <span class="n">content</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">IResultsPresenter</span> <span class="n">presenter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">FragmentResults</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Required empty public constructor</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
</span><span class='line'>                             <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_results</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewCreated</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onViewCreated</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">presenter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultsPresenter</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">title</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">results_title</span><span class="o">);</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">results_text</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">presenter</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showResults</span><span class="o">(</span><span class="n">String</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">results</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>很明显，我们就可以脱离用户接口来测试这些逻辑</p>

<figure class='code'><figcaption><span>presenterInteface</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestResultsPresenter</span> <span class="kd">extends</span> <span class="n">AndroidTestCase</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">IResultsPresenter</span> <span class="n">resultsPresenter</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">resultTitle</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">resultData</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">TestResultsPresenter</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">setUp</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">IResultsView</span> <span class="n">resultsView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestResultsView</span><span class="o">();</span>
</span><span class='line'>        <span class="n">resultsPresenter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultsPresenter</span><span class="o">(</span><span class="n">resultsView</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">tearDown</span><span class="o">();</span>
</span><span class='line'>        <span class="n">resultsPresenter</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testResultFormat</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Utilities</span><span class="o">.</span><span class="na">SmsResultManager</span> <span class="n">smsResultManager</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="na">SmsResultManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
</span><span class='line'>        <span class="n">smsResultManager</span><span class="o">.</span><span class="na">removeAllSmsResults</span><span class="o">();</span>
</span><span class='line'>        <span class="n">smsResultManager</span><span class="o">.</span><span class="na">saveResult</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">SmsResult</span><span class="o">(</span><span class="s">&quot;ark&quot;</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Build expected Content</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">expectedContent</span> <span class="o">=</span> <span class="s">&quot;ark\t\tfoo\t\tUnknown\n&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">resultsPresenter</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">assertEquals</span><span class="o">(</span><span class="n">expectedContent</span><span class="o">,</span> <span class="n">resultData</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testResultTitle</span><span class="o">(){</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// put something</span>
</span><span class='line'>        <span class="n">Date</span> <span class="n">nowDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
</span><span class='line'>        <span class="n">DateFormat</span> <span class="n">df</span> <span class="o">=</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">getDateTimeInstance</span><span class="o">(</span>
</span><span class='line'>                <span class="n">DateFormat</span><span class="o">.</span><span class="na">SHORT</span><span class="o">,</span>
</span><span class='line'>                <span class="n">DateFormat</span><span class="o">.</span><span class="na">SHORT</span><span class="o">,</span>
</span><span class='line'>                <span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Set date time in prefs</span>
</span><span class='line'>        <span class="n">Preferences</span><span class="o">.</span><span class="na">writePreferenceValue</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span>
</span><span class='line'>                <span class="n">getContext</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">pref_emergency_date_time_key</span><span class="o">),</span> <span class="n">nowDate</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">String</span> <span class="n">formattedDateTime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">nowDate</span><span class="o">);</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">expectedTitle</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">results_title</span><span class="o">),</span>
</span><span class='line'>                <span class="n">formattedDateTime</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Trigger onResume event in Results Presenter</span>
</span><span class='line'>        <span class="n">resultsPresenter</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Test not null</span>
</span><span class='line'>        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">resultTitle</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Test as expected</span>
</span><span class='line'>        <span class="n">assertEquals</span><span class="o">(</span><span class="n">expectedTitle</span><span class="o">,</span> <span class="n">resultTitle</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">TestResultsView</span> <span class="kd">implements</span> <span class="n">IResultsView</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">resultTitle</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showResults</span><span class="o">(</span><span class="n">String</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">resultData</span> <span class="o">=</span> <span class="n">results</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-24T23:05:55+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/other/'>Other</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/24/4/" itemprop="url">十四个很准的心里暗示</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>1、当你对某件事情抱着百分之一万的相信，它最后就会变成事实。</p>

<p>2、期望定律 期望定律告诉我们，当我们怀着对某件事情非常强烈期望的时候，我们所期望的事物就会出现。</p>

<p>3、情绪定律 情绪定律告诉我们，人百分之百是情绪化的。即使有人说某人很理性，其实当这个人很有&#8221;理性&#8221;地思考问题的时候，也是受到他当时情绪状态的影响，&#8221;理性地思考&#8221;本身也是一种情绪状态。所以人百分之百是情绪化的动物，而且任何时候的决定都是情绪化的决定。</p>

<p>4、因果定律 任何事情的发生，都有其必然的原因。有因才有果。换句话说，当你看到任何现象的时候，你不用觉得不可理解或者奇怪，因为任何事情的发生都必有其原因。你今天的现状结果是你过去种下的因导致的结果。</p>

<p>5、吸引定律 当你的思想专注在某一领域的时候，跟这个领域相关的人、事、物就会被你吸引而来。</p>

<p> 6、重复定律 任何的行为和思维，只要你不断的重复就会得到不断的加强。在你的潜意识当中，只要你能够不断地重复一些人、事、物，它们都会在潜意识里变成事实。</p>

<p> 7、累积定律 很多年轻人都曾梦想做一番大事业，其实天下并没有什么大事可做，有的只是小事。一件一件小事累积起来就形成了大事。任何大成就或者大灾难都是累积的结果。</p>

<p>8、辐射定律 当你做一件事情的时候，影响的并不只是这件事情的本身，它还会辐射到相关的其他领域。任何事情都有辐射作用。</p>

<p>9、相关定律 相关定律告诉我们：这个世界上的每一件事情之间都有一定的联系，没有一件事情是完全独立的。要解决某个难题最好从其他相关的某个地方人手，而不只是专注在一个困难点上。</p>

<p> 10、专精定律 专精定律告诉我们，只有专精在一个领域，这个领域才能有所发展。所以无论你做任何的行业都要把做该行业的最顶尖为目标，只有当你能够专精的时候，你所做的领域才会出类拔萃地成长。</p>

<p> 11、替换定律 替换定律就是说，当我们有一项不想要的记忆或者是负面的习惯，我们是无法完全去除掉，只能用一种新的记忆或新的习惯去替换他。</p>

<p> 12、惯性定律 任何事情只要你能够持续不断去加强它，它终究会变成一种习惯。</p>

<p>13、显现定律 显现定律就是说，当我们持续寻找、追问答案的时候，它们最终都必将显现。</p>

<p> 14、需求定律 任何人做任何事情都是带有一种需求。尊重并满足对方的需求，别人才会尊重我们的需求</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-24T23:05:52+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/24/adb-commands-for-android/" itemprop="url">Handy Adb Commands for Android</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>查看连接的设备</h4>

<p>使用这个命令查看当前连接的所有设备和它们的ID</p>

<p><code>adb devices</code></p>

<p>如果你有多个设备连接，使用<code>adb -s DEVICE_ID</code>选中你需要操作的设备</p>

<h4>安装应用</h4>

<p>使用<code>install</code>命令安装apk，如果你已经安装过当前程序，并且想保存当前的数据，可以加上&#8220;-r&#8220;`参数来覆盖安装当前程序</p>

<p><code>
adb
</code>
记录下在使用android adb操作时常用的命令，可以方便我们在开发过程中构建和测试程序。</p>

<h4>卸载程序</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb uninstall PACKAGE_NAME
</span><span class='line'>//example
</span><span class='line'>adb uninstall com.shaojie.name.example</span></code></pre></td></tr></table></div></figure>


<h4>启动一个Activity</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell am start PACKAGE_NAME/ACTIVITY_IN_PACKAGE
</span><span class='line'>adb shell am start PACKAGE_NAME/FULLY_QUALIFIED_ACTIVITY
</span><span class='line'>//example
</span><span class='line'>adb shell am start -n com.shaojie.name.example/.MainActiivty
</span><span class='line'>adb shell am start -n com.shaojie.name.example/com.shaojie.name.MainActivity</span></code></pre></td></tr></table></div></figure>


<h4>进入设备的shell</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell</span></code></pre></td></tr></table></div></figure>


<h4>截屏</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell screencap -p | perl -pe 's/\x0D\x0A/\x0A/g' &gt; screen.png</span></code></pre></td></tr></table></div></figure>


<h4>点击电源键</h4>

<p>这个命令发送一个关闭屏幕的事件到设备</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell input keyevent 26</span></code></pre></td></tr></table></div></figure>


<h4>屏幕解锁</h4>

<p>与上面的命令作用相反，用于点亮屏幕解锁</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell input keyevent 82</span></code></pre></td></tr></table></div></figure>


<h4>显示安装的程序包</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb shell pm list packages -f</span></code></pre></td></tr></table></div></figure>


<h4>Logging</h4>

<p>显示系统的日志到命令行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat</span></code></pre></td></tr></table></div></figure>


<h4>TagName过滤</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat -s TAG_NAME
</span><span class='line'>adb logcat -s TAG_NAME_1 TAG_NAME_2
</span><span class='line'>//
</span><span class='line'>adb logcat -s TEST
</span><span class='line'>adb logcat -s TEST MYAPP</span></code></pre></td></tr></table></div></figure>


<h4>优先级过滤</h4>

<p>显示某个级别以及以上优先级的日志</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat "*:PRIORITY"
</span><span class='line'>//example
</span><span class='line'>adb logcat "*:W"</span></code></pre></td></tr></table></div></figure>


<ul>
<li>V-Verbose</li>
<li>D_Debug</li>
<li>I-Info</li>
<li>W-Warning</li>
<li>E-Error</li>
<li>F-Fatal</li>
<li>S-Silent(最高级别)</li>
</ul>


<h4>优先级和tagname过滤</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat -s TAG_NAME:PRIORITY
</span><span class='line'>adb logcat -s TAG_NAME_1:PRIORITY TAG_NAME_2:PROPRITY
</span><span class='line'>//example
</span><span class='line'>adb logcat -s TEST: W</span></code></pre></td></tr></table></div></figure>


<h4>grep过滤</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat | grep "SEARCH_TERM"
</span><span class='line'>adb logcat | grep "SEARCH_TERM_1\|SEARCH_TERM_2"
</span><span class='line'>//example
</span><span class='line'>adb logcat | grep "Exception"
</span><span class='line'>adb logcat | grep "Exveption\|Error"</span></code></pre></td></tr></table></div></figure>


<h4>清除logcat日志</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adb logcat -c</span></code></pre></td></tr></table></div></figure>


<h4>更多</h4>

<p>更加细节，当然是官方文档，<a href="http://developer.android.com/tools/help/adb.html">传送门</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-24T23:05:43+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/24/android-asynchronous-Loader/" itemprop="url">Android Asynchronous Loader</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>Loader概述</h4>

<p>装载器从android3.0开始引进。它使得在activity或fragment中异步加载数据变得简单。装载器具有如下特性:</p>

<ul>
<li>它们对每个Activity和Fragment都有效</li>
<li>他们提供了异步加载数据的能力</li>
<li>它们监听数据，并在数数据发生变化时传递新的结果</li>
<li>当由于配置改变而被重新创建后，它们自动重连到上一个加载器的游标，所以不必重新查询数据</li>
</ul>


<h5>API概述</h5>

<h6>LoaderManager</h6>

<p>一个抽像类，关联到一个Activity或Fragment，管理一个或多个装载器的实例。这帮助一个应用管理那些与Activity或Fragment的生命周期相关的长时间运行的的操作。最常见的方式是与一个CursorLoader一起使用，然而应用是可以随便写它们自己的装载器以加载其它类型的数据。
每个activity或fragment只有一个LoaderManager。但是一个LoaderManager可以拥有多个装载器。</p>

<h6>LoadManager.LoaderCallbacks</h6>

<p>一个用于客户端与LoaderManager交互的回调接口。例如，你使用回调方法onCreateLoader()来创建一个新的装载器。</p>

<h6>Loader</h6>

<p>一个执行异步数据加载的抽象类。它是加载器的基类。你可以使用典型的CursorLoader，但是你也可以实现你自己的子类。一旦装载器被激活，它们将监视它们的数据源并且在数据改变时发送新的结果。</p>

<h6>AsyncTaskLoader</h6>

<p>提供一个AsyncTask来执行异步加载工作的抽象类。</p>

<h6>CursorLoader</h6>

<p>AsyncTaskLoader的子类，它查询ContentResolver然后返回一个Cursor。这个类为查询cursor以标准的方式实现了装载器的协议，它的游标查询是通过AsyncTaskLoader在后台线程中执行，从而不会阻塞界面。使用这个装载器是从一个ContentProvider异步加载数据的最好方式。相比之下，通过fragment或activity的API来执行一个被管理的查询就不行了</p>

<h5>使用</h5>

<p>一个使用装载器的应用会包含如下组件：</p>

<ul>
<li>一个Activity或Fragment</li>
<li>一个LoaderManager的实例</li>
<li>一个加载被ContentProvider所支持的数据的CursorLoader．或者，你可以从Loader或AsyncTaskLoader实现你自己的装载器来从其它源加载数据</li>
<li>一个LoaderManager.LoaderCallbacks的实现．这是你创建新的装载器以及管理你的已有装载器的引用的地方</li>
<li>一个显示装载器的数据的途径，例如使用一个SimpleCursorAdapter</li>
<li>一个数据源，比如当是用CursorLoader时，它将是一个ContentProvider</li>
</ul>


<h5>启动一个装载器</h5>

<p>LoaderManager管理一个Activiry或Fragment中的一个或多个装载器．但每个activity或fragment只拥有一个LoaderManager．</p>

<p>你通常要在activity的onCreate()方法中或fragment的onActivityCreated()方法中初始化一个装载器．你可以如下创建：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getLoaderManager().initLoader(0,null, this);  </span></code></pre></td></tr></table></div></figure>


<p>initLoader()方法有一下参数</p>

<ul>
<li>一个唯一ID来标志装载器．在这个例子中，ID是0</li>
<li>可选的参数，用于装载器初始化时(本例中是null)</li>
<li>一个LoaderManager.LoaderCallbacks的实现．被LoaderManager调用以报告装载器的事件，在这个例子中，类本实现了这个接口，所以传的是它自己：this</li>
</ul>


<p>initLoader()保证一个装载器被初始化并激活．它具有两种可能的结果：</p>

<ul>
<li>如果ID所指的装载器已经存在，那么这个装载器将被重用</li>
<li>如果装载器不存在，initLoader()就触发LoaderManager.LoaderCallbacks的方法onCreateLoader()．这是你实例化并返回一个新装载器的地方</li>
</ul>


<p>在这两种情况中，传入的LoaderManager.LoaderCallbacks的实现都与装载器绑定在一起．并且会在装载器状态变化时被调用．如果在调用这个方法时，调用者正处于启动状态，并且所请求的装载器已存在并产生了数据，那么系统会马上调用onLoadFinished()(也就是说在initLoader()还在执行时)．所以你必须为这种情况的发生做好准备.</p>

<h5>重启装载器</h5>

<p>当你使用initLoader()时，如果指定ID的装载器已经存在，则它使用这个装载器．如果不存在呢，它将创建一个新的．但是有时你却是想丢弃旧的然后开始新的数据．</p>

<p>要想丢弃旧数据，你应使用restartLoader()。</p>

<h5>回调</h5>

<p>LoaderManager.LoaderCallbacks是一个回调接口，它使得客户端可以与LoaderManager进行交互．</p>

<p>装载器，一般指的是CursorLoader，我们希望在它停止后依然保持数据．这使得应用可以在activity或fragment的 onStop() 和onStart() 之间保持数据，所以当用户回到一个应用时，它们不需等待数据加载．你使用LoaderManager.LoaderCallbacks 的方法们，在需要时创建新的装载器，并且告诉应用什么时候要停止使用装载器的数据．</p>

<p>LoaderManager.LoaderCallbacks 包含以下方法们:</p>

<ul>
<li>onCreateLoader() —跟据传入的ID，初始化并返回一个新的装载器．</li>
<li>onLoadFinished() —当一个装载器完成了它的装载过程后被调用</li>
<li>onLoaderReset() —当一个装载器被重置而什其数据无效时被调用</li>
</ul>


<figure class='code'><figcaption><span>Loader www.shaojie.name</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CursorLoaderListFragment</span> <span class="kd">extends</span> <span class="n">ListFragment</span>
</span><span class='line'>        <span class="kd">implements</span> <span class="n">OnQueryTextListener</span><span class="o">,</span> <span class="n">LoaderManager</span><span class="o">.</span><span class="na">LoaderCallbacks</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// This is the Adapter being used to display the list&#39;s data.</span>
</span><span class='line'>    <span class="n">SimpleCursorAdapter</span> <span class="n">mAdapter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// If non-null, this is the current filter the user has provided.</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">mCurFilter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onActivityCreated</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityCreated</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Give some text to display if there is no data.  In a real</span>
</span><span class='line'>        <span class="c1">// application this would come from a resource.</span>
</span><span class='line'>        <span class="n">setEmptyText</span><span class="o">(</span><span class="s">&quot;No phone numbers&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// We have a menu item to show in action bar.</span>
</span><span class='line'>        <span class="n">setHasOptionsMenu</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Create an empty adapter we will use to display the loaded data.</span>
</span><span class='line'>        <span class="n">mAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleCursorAdapter</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span>
</span><span class='line'>                <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">simple_list_item_2</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span>
</span><span class='line'>                <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">DISPLAY_NAME</span><span class="o">,</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">CONTACT_STATUS</span> <span class="o">},</span>
</span><span class='line'>                <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">text1</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">text2</span> <span class="o">},</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setListAdapter</span><span class="o">(</span><span class="n">mAdapter</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Prepare the loader.  Either re-connect with an existing one,</span>
</span><span class='line'>        <span class="c1">// or start a new one.</span>
</span><span class='line'>        <span class="n">getLoaderManager</span><span class="o">().</span><span class="na">initLoader</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">,</span> <span class="n">MenuInflater</span> <span class="n">inflater</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Place an action bar item for searching.</span>
</span><span class='line'>        <span class="n">MenuItem</span> <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Search&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">item</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_menu_search</span><span class="o">);</span>
</span><span class='line'>        <span class="n">item</span><span class="o">.</span><span class="na">setShowAsAction</span><span class="o">(</span><span class="n">MenuItem</span><span class="o">.</span><span class="na">SHOW_AS_ACTION_IF_ROOM</span><span class="o">);</span>
</span><span class='line'>        <span class="n">SearchView</span> <span class="n">sv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchView</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>
</span><span class='line'>        <span class="n">sv</span><span class="o">.</span><span class="na">setOnQueryTextListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="n">item</span><span class="o">.</span><span class="na">setActionView</span><span class="o">(</span><span class="n">sv</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onQueryTextChange</span><span class="o">(</span><span class="n">String</span> <span class="n">newText</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Called when the action bar search text has changed.  Update</span>
</span><span class='line'>        <span class="c1">// the search filter, and restart the loader to do a new query</span>
</span><span class='line'>        <span class="c1">// with this filter.</span>
</span><span class='line'>        <span class="n">mCurFilter</span> <span class="o">=</span> <span class="o">!</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">newText</span><span class="o">)</span> <span class="o">?</span> <span class="n">newText</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="n">getLoaderManager</span><span class="o">().</span><span class="na">restartLoader</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">onQueryTextSubmit</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Don&#39;t care about this.</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onListItemClick</span><span class="o">(</span><span class="n">ListView</span> <span class="n">l</span><span class="o">,</span> <span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Insert desired behavior here.</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;FragmentComplexList&quot;</span><span class="o">,</span> <span class="s">&quot;Item clicked: &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// These are the Contacts rows that we will retrieve.</span>
</span><span class='line'>    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">CONTACTS_SUMMARY_PROJECTION</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">_ID</span><span class="o">,</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">DISPLAY_NAME</span><span class="o">,</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">CONTACT_STATUS</span><span class="o">,</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">CONTACT_PRESENCE</span><span class="o">,</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">PHOTO_ID</span><span class="o">,</span>
</span><span class='line'>        <span class="n">Contacts</span><span class="o">.</span><span class="na">LOOKUP_KEY</span><span class="o">,</span>
</span><span class='line'>    <span class="o">};</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="nf">onCreateLoader</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// This is called when a new Loader needs to be created.  This</span>
</span><span class='line'>        <span class="c1">// sample only has one Loader, so we don&#39;t care about the ID.</span>
</span><span class='line'>        <span class="c1">// First, pick the base URI to use depending on whether we are</span>
</span><span class='line'>        <span class="c1">// currently filtering.</span>
</span><span class='line'>        <span class="n">Uri</span> <span class="n">baseUri</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">mCurFilter</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">baseUri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">withAppendedPath</span><span class="o">(</span><span class="n">Contacts</span><span class="o">.</span><span class="na">CONTENT_FILTER_URI</span><span class="o">,</span>
</span><span class='line'>                    <span class="n">Uri</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">mCurFilter</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">baseUri</span> <span class="o">=</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">CONTENT_URI</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Now create and return a CursorLoader that will take care of</span>
</span><span class='line'>        <span class="c1">// creating a Cursor for the data being displayed.</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">select</span> <span class="o">=</span> <span class="s">&quot;((&quot;</span> <span class="o">+</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">DISPLAY_NAME</span> <span class="o">+</span> <span class="s">&quot; NOTNULL) AND (&quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">HAS_PHONE_NUMBER</span> <span class="o">+</span> <span class="s">&quot;=1) AND (&quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">Contacts</span><span class="o">.</span><span class="na">DISPLAY_NAME</span> <span class="o">+</span> <span class="s">&quot; != &#39;&#39; ))&quot;</span><span class="o">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">CursorLoader</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="n">baseUri</span><span class="o">,</span>
</span><span class='line'>                <span class="n">CONTACTS_SUMMARY_PROJECTION</span><span class="o">,</span> <span class="n">select</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span>
</span><span class='line'>                <span class="n">Contacts</span><span class="o">.</span><span class="na">DISPLAY_NAME</span> <span class="o">+</span> <span class="s">&quot; COLLATE LOCALIZED ASC&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">,</span> <span class="n">Cursor</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Swap the new cursor in.  (The framework will take care of closing the</span>
</span><span class='line'>        <span class="c1">// old cursor once we return.)</span>
</span><span class='line'>        <span class="n">mAdapter</span><span class="o">.</span><span class="na">swapCursor</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoaderReset</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// This is called when the last Cursor provided to onLoadFinished()</span>
</span><span class='line'>        <span class="c1">// above is about to be closed.  We need to make sure we are no</span>
</span><span class='line'>        <span class="c1">// longer using it.</span>
</span><span class='line'>        <span class="n">mAdapter</span><span class="o">.</span><span class="na">swapCursor</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Loader的使用分一下几个步骤：</p>

<ul>
<li>实现自己的异步Loader ,如本篇的AsyncTaskLoader或者CursorLoader或者自己继承Loader，第二步需要用到这个Loader</li>
<li>创建数据源 XXXAdapter.</li>
<li>在Activity 或者Fragments 上实现OnQueryTextListener,LoaderManager.LoaderCallbacks接口</li>
<li>在onCreateLoader里面返回Loader，在onLoadfinished里面做清除动作，在onQueryTextChange或者onQueryTextSubmit改变数据源，在onCreate里面让Loader去执行请求数据getLoaderManager().initLoader(0, null, this)</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-24T23:05:38+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/24/android-asynchronous-IntentService/" itemprop="url">Android Asynchrous IntentService</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>Service</h4>

<h6>Service种类</h6>

<table>
<thead>
<tr>
<th></th>
<th>类别 </th>
<th> 区别  </th>
<th>  优点   </th>
<th>缺点   </th>
<th>应用   </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> 本地服务（Local)  </td>
<td> 该服务依附在主进程上  </td>
<td> 服务依附在主进程上而不是独立的进程，这样在一定程度上节约了资源，另外Local服务因为是在同一进程因此不需要IPC，也不需要AIDL。相应bindService会方便很多。  </td>
<td> 主进程被Kill后，服务便会终止</td>
<td>非常常见的应用如：音乐播放服务，Push服务。  |   </td>
</tr>
<tr>
<td></td>
<td> 远程服务（Remote）  </td>
<td> 该服务是独立的进程  </td>
<td> 服务为独立的进程，对应进程名格式为所在包名加上你指定的android:process字符串。由于是独立的进程，因此在Activity所在进程被Kill的时候，该服务依然在运行，不受其他进程影响，有利于为多个进程提供服务具有较高的灵活性  </td>
<td> 该服务是独立的进程，会占用一定资源，并且使用AIDL进行IPC稍微麻烦一点</td>
<td> 一些提供系统服务的Service，这种Service是常驻的  |   </td>
</tr>
</tbody>
</table>


<h5>service运行分类</h5>

<table>
<thead>
<tr>
<th></th>
<th>类别 </th>
<th> 区别 </th>
<th>应用</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>前台服务</td>
<td>会在通知一栏显示 ONGOING 的 Notification</td>
<td>当服务被终止的时候，通知一栏的 Notification 也会消失，这样对于用户有一定的通知作用。常见的如音乐播放服务|</td>
</tr>
<tr>
<td></td>
<td>后台服务</td>
<td>默认的服务即为后台服务，即不会在通知一栏显示 ONGOING 的 Notification</td>
<td>当服务被终止的时候，用户是看不到效果的。某些不需要运行或终止提示的服务，如天气更新，日期同步，邮件同步等|</td>
</tr>
</tbody>
</table>


<h5>Service 与 Thread的区别</h5>

<ol>
<li>Thread：Thread是程序执行的最小单元，它是分配CPU的基本单位。可以用 Thread 来执行一些异步的操作。</li>
<li>Service：Service 是Android的一种机制，当它运行的时候如果是Local Service，那么对应的 Service 是运行在主进程的 main 线程上的。如：onCreate，onStart 这些函数在被系统调用的时候都是在主进程的 main 线程上运行的。如果是Remote Service，那么对应的 Service 则是运行在独立进程的 main 线程上。</li>
</ol>


<p>那么我们为什么要用 Service 呢？其实这跟 android 的系统机制有关，我们先拿 Thread 来说。Thread 的运行是独立于 Activity 的，也就是说当一个 Activity 被 finish 之后，如果你没有主动停止 Thread 或者 Thread 里的 run 方法没有执行完毕的话，Thread 也会一直执行。因此这里会出现一个问题：当 Activity 被 finish 之后，你不再持有该 Thread 的引用。另一方面，你没有办法在不同的 Activity 中对同一 Thread 进行控制。</p>

<h5>Service生命周期</h5>

<ol>
<li>三个阶段：创建-开始-销毁</li>
<li>Oncreate();Service 声明周期的开始，完成Service的初始化工作</li>
<li>OnStartCommand(); 服务声明周期开始，没有对应的停止函数</li>
<li>OnDestory(); 声明周期的结束，释放Service所占用的资源</li>
</ol>


<h5>Service启动方式</h5>

<ol>
<li>Conetext.startService()</li>
<li>Conetext.bindService();</li>
</ol>


<h4>IntentService</h4>

<p>IntentService继承与Service，它最大的特点是对服务请求逐个进行处理。当我们要提供的服务不需要同时处理多个请求的时候，可以选择继承IntentService。</p>

<h5>使用IntentService有几个需要注意的地方：</h5>

<ol>
<li>它不能直接与用户交互，如果想把数据传递给用户界面，需要把值先传递给Activity</li>
<li>一个intentService可以处理多个任务，只不过是一个接着一个的顺序来处理的,后面的任务需要在前一个完成后才能执行</li>
<li>运行在IntetService中的操作是不能被打断的</li>
</ol>


<h6>IntentService的特点</h6>

<ol>
<li><p>它创建了一个独立的工作线程来处理所有的通过onStartCommand()传递给服务的intents。</p></li>
<li><p>创建了一个工作队列，来逐个发送intent给onHandleIntent()。</p></li>
<li><p> 不需要主动调用stopSelft()来结束服务。因为，在所有的intent被处理完后，系统会自动关闭服务。</p></li>
<li><p> 默认实现的onBind()返回null</p></li>
<li><p>默认实现的onStartCommand()的目的是将intent插入到工作队列中。</p></li>
</ol>


<h6>源码分析</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java Interservice www.shaojie.name
</span><span class='line'>public abstract class IntentService extends Service { 
</span><span class='line'>
</span><span class='line'>        private volatile Looper mServiceLooper; 
</span><span class='line'>        private volatile ServiceHandler mServiceHandler; 
</span><span class='line'>
</span><span class='line'>        private String mName; 
</span><span class='line'>        private boolean mRedelivery; 
</span><span class='line'>    
</span><span class='line'>
</span><span class='line'>        private final class ServiceHandler extends Handler { 
</span><span class='line'>
</span><span class='line'>                public ServiceHandler(Looper looper) { 
</span><span class='line'>                        super(looper); 
</span><span class='line'>                } 
</span><span class='line'>    
</span><span class='line'>                @Override 
</span><span class='line'>                public void handleMessage(Message msg) { 
</span><span class='line'>                        onHandleIntent((Intent)msg.obj); 
</span><span class='line'>                        stopSelf(msg.arg1); 
</span><span class='line'>                } 
</span><span class='line'>
</span><span class='line'>        }</span></code></pre></td></tr></table></div></figure>


<p>从源码可以分析出:
IntentService 实际上是Looper,Handler,Service 的集合体,他不仅有服务的功能,还有处理和循环消息的功能</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override 
</span><span class='line'>public void onCreate() { 
</span><span class='line'>        super.onCreate(); 
</span><span class='line'>
</span><span class='line'>        HandlerThread thread = new HandlerThread("IntentService[" + mName + "]"); 
</span><span class='line'>        thread.start(); 
</span><span class='line'>
</span><span class='line'>        mServiceLooper = thread.getLooper(); 
</span><span class='line'>        mServiceHandler = new ServiceHandler(mServiceLooper); 
</span><span class='line'>        }</span></code></pre></td></tr></table></div></figure>


<p>IntentService创建时就会创建Handler线程(HandlerThread)并且启动,然后再得到当前线程的Looper对象来初始化IntentService的mServiceLooper,接着创建mServicehandler对象.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override 
</span><span class='line'>        public void onStart(Intent intent, int startId) { 
</span><span class='line'>                Message msg = mServiceHandler.obtainMessage(); 
</span><span class='line'>                msg.arg1 = startId; 
</span><span class='line'>                msg.obj = intent; 
</span><span class='line'>
</span><span class='line'>                mServiceHandler.sendMessage(msg); 
</span><span class='line'>        }</span></code></pre></td></tr></table></div></figure>


<p>当你启动IntentService的时候,就会产生一条附带startId和Intent的Message并发送到MessageQueue中,接下来Looper发现MessageQueue中有Message的时候,就会停止Handler处理消息.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> @Override 
</span><span class='line'>        public void handleMessage(Message msg) { 
</span><span class='line'>                        onHandleIntent((Intent)msg.obj); 
</span><span class='line'>                        stopSelf(msg.arg1); 
</span><span class='line'>        }</span></code></pre></td></tr></table></div></figure>


<p>接着调用 onHandleIntent((Intent)msg.obj),这是一个抽象的方法,其实就是我们要重写实现的方法,我们可以在这个方法里面处理我们的工作.当任务完成时就会调用stopSelf(msg.arg1)这个方法来结束指定的工作</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override 
</span><span class='line'>        public void onDestroy() { 
</span><span class='line'>                mServiceLooper.quit(); 
</span><span class='line'>        }</span></code></pre></td></tr></table></div></figure>


<p>当所有的工作执行完后:就会执行onDestroy方法,服务结束后调用这个方法 mServiceLooper.quit()使looper停下来.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-18T00:03:02+08:00" data-updated="true" itemprop="datePublished">Mar 18<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/18/android-asynchronous-asynctask/" itemprop="url">Android Asynchronous AsyncTask</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>AsyncTask介绍</h4>

<p>AsyncTask是Android为我们提供的方便编写异步任务的工具类，可以代替Thread和Handler。但是AsyncTask主要还是用来处理耗时不太长的操作，如果你需要保持一个线程在后台运行很长时间，建议使用java.util.concurrent包下的Executor, ThreadpoolExecutor和FutureTask。
由于AsyncTask是一个抽象类，所以如果我们想使用它，就必须要创建一个子类去继承它。在继承时我们可以为AsyncTask类指定三个泛型参数，这三个参数的用途如下</p>

<ol>
<li>Params
在执行AsyncTask时需要传入的参数，可用于在后台任务中使用。</li>
<li>Progress
后台任务执行时，如果需要在界面上显示当前的进度，则使用这里指定的泛型作为进度单位。</li>
<li>Result
当任务执行完毕后，如果需要对结果进行返回，则使用这里指定的泛型作为返回值类型。</li>
</ol>


<p>AsyncTask的执行分为四个步骤，每一步都对应一个回调方法，这些方法不应该由应用程序调用，开发者需要做的就是实现这些方法。</p>

<ol>
<li>onPreExecute(), 该方法将在执行实际的后台操作前被UI thread调用。可以在该方法中做一些准备工作，如在界面上显示一个进度条。</li>
<li>doInBackground(Params&hellip;), 将在onPreExecute 方法执行后马上执行，该方法运行在后台线程中。这里将主要负责执行那些很耗时的后台计算工作。可以调用 publishProgress方法来更新实时的任务进度。该方法是抽象方法，子类必须实现。</li>
<li>onProgressUpdate(Progress&hellip;),在publishProgress方法被调用后，UI thread将调用这个方法从而在界面上展示任务的进展情况，例如通过一个进度条进行展示。</li>
<li>onPostExecute(Result), 在doInBackground 执行完成后，onPostExecute 方法将被UI thread调用，后台的计算结果将通过该方法传递到UI thread.</li>
</ol>


<p>为了正确的使用AsyncTask类，以下是几条必须遵守的准则：</p>

<ol>
<li>Task的实例必须在UI thread中创建</li>
<li>execute方法必须在UI thread中调用</li>
<li>不要手动的调用onPreExecute(), onPostExecute(Result)，doInBackground(Params&hellip;), onProgressUpdate(Progress&hellip;)这几个方法</li>
<li>该task只能被执行一次，否则多次调用时将会出现异常 doInBackground方法和onPostExecute的参数必须对应，这两个参数在AsyncTask声明的泛型参数列表中指定，第一个为doInBackground接受的参数，第二个为显示进度的参数，第三个为doInBackground返回和onPostExecute传入的参数。</li>
</ol>


<figure class='code'><figcaption><span>AsyncTaks</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">class</span> <span class="nc">DownloadFilesTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">URL</span><span class="o">,</span> <span class="n">Integer</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>     <span class="kd">protected</span> <span class="n">Long</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">URL</span><span class="o">...</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span><span class='line'>         <span class="kt">long</span> <span class="n">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>         <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>             <span class="n">totalSize</span> <span class="o">+=</span> <span class="n">Downloader</span><span class="o">.</span><span class="na">downloadFile</span><span class="o">(</span><span class="n">urls</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
</span><span class='line'>             <span class="n">publishProgress</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">i</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">count</span><span class="o">)</span> <span class="o">*</span> <span class="mi">100</span><span class="o">));</span>
</span><span class='line'>             <span class="c1">// Escape early if cancel() is called</span>
</span><span class='line'>             <span class="k">if</span> <span class="o">(</span><span class="n">isCancelled</span><span class="o">())</span> <span class="k">break</span><span class="o">;</span>
</span><span class='line'>         <span class="o">}</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">totalSize</span><span class="o">;</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onProgressUpdate</span><span class="o">(</span><span class="n">Integer</span><span class="o">...</span> <span class="n">progress</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">setProgressPercent</span><span class="o">(</span><span class="n">progress</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">Long</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">showDialog</span><span class="o">(</span><span class="s">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">result</span> <span class="o">+</span> <span class="s">&quot; bytes&quot;</span><span class="o">);</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>执行Task:</p>

<figure class='code'><figcaption><span>AsyncTaks</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">DownloadFilesTask</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="n">url1</span><span class="o">,</span> <span class="n">url2</span><span class="o">,</span> <span class="n">url3</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-17T23:06:29+08:00" data-updated="true" itemprop="datePublished">Mar 17<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/17/android-asynchronous-handlerthread/" itemprop="url">Android Asynchronous HandlerThread</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>Looper</h4>

<p>Looper是用于给一个线程添加一个消息队列(MessageQueue)，并且循环等待，当有消息时会唤起线程来处理消息的一个工具，直到线程结束为止。通常情况下不会用到Looper，因为对于Activity，Service等系统组件，Frameworks已经为我们初始化好了线程(俗称的UI线程或主线程)，在其内含有一个Looper，和由Looper创建的消息队列，所以主线程会一直运行，处理用户事件，直到某些事件(BACK）退出。
如果，我们需要新建一个线程，并且这个线程要能够循环处理其他线程发来的消息事件，或者需要长期与其他线程进行复杂的交互，这时就需要用到Looper来给线程建立消息队列.</p>

<h5>使用Looper:</h5>

<figure class='code'><figcaption><span>Looper</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">class</span> <span class="nc">LooperThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">public</span> <span class="n">Handler</span> <span class="n">mHandler</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>              <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="c1">// process incoming messages here</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样你的线程就具有了消息处理机制了，在Handler中进行消息处理.
Looper最主要的有四个:</p>

<figure class='code'><figcaption><span>Looper</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="kd">public</span> <span class="kd">static</span> <span class="nf">prepare</span><span class="o">();</span>
</span><span class='line'> <span class="kd">public</span> <span class="kd">static</span> <span class="nf">myLooper</span><span class="o">();</span>
</span><span class='line'> <span class="kd">public</span> <span class="kd">static</span> <span class="nf">loop</span><span class="o">();</span>
</span><span class='line'> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">quit</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用方法如下：</p>

<ol>
<li>在每个线程的run()方法中的最开始调用Looper.prepare()，这是为线程初始化消息队列。</li>
<li>之后调用Looper.myLooper()获取此Looper对象的引用。这不是必须的，但是如果你需要保存Looper对象的话，一定要在prepare()之后，否则调用在此对象上的方法不一定有效果，如looper.quit()就不会退出。</li>
<li>在run()方法中添加Handler来处理消息</li>
<li>添加Looper.loop()调用，这是让线程的消息队列开始运行，可以接收消息了。</li>
<li>在想要退出消息循环时，调用Looper.quit()注意，这个方法是要在对象上面调用，很明显，用对象的意思就是要退出具体哪个Looper。如果run()中无其他操作，线程也将终止运行。</li>
</ol>


<h4>Handler</h4>

<p>Handler是用于操作线程内部的消息队列的类。Looper是用于给线程创建消息队列用的，也就是说Looper可以让消息队列(MessageQueue)附属在线程之内，并让消息队列循环起来，接收并处理消息。但，我们并不直接的操作消息队列，而是用Handler来操作消息队列，给消息队列发送消息，和从消息队列中取出消息并处理。这就是Handler的职责。</p>

<p>Handler主要有二个用途，一个是用于线程内部消息循环； 另外一个就是用于线程间通讯，主要方法：</p>

<figure class='code'><figcaption><span>Looper</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">sendEmptyMessageDelayed</span><span class="o">(</span><span class="kt">int</span> <span class="n">msgid</span><span class="o">,</span> <span class="kt">long</span> <span class="n">after</span><span class="o">);</span>
</span><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">sendMessageDelayed</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">,</span> <span class="kt">long</span> <span class="n">after</span><span class="o">);</span>
</span><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="kt">long</span> <span class="n">after</span><span class="o">);</span>
</span><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">sendMessageAtTime</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timeMillis</span><span class="o">);</span>
</span><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">sendEmptyMessageAtTime</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timeMiilis</span><span class="o">);</span>
</span><span class='line'><span class="n">Handler</span><span class="o">.</span><span class="na">postAtTime</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timeMillis</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>
需要注意一点的是，线程内部消息循环并不是并发处理，也就是所有的消息都是在Handler所属的线程内处理的，所以虽然你用post(Runnable r)，发给MessageQueue一个Runnable，但这并不会创建新的线程来执行，处理此消息时仅是调用r.run()。（想要另起线程执行，必须把Runnable放到一个Thread中）。</p>

<h4>Handler</h4>

<p>一般会使用Handler handler = new Handler(){&hellip;}创建Handler。这样创建的handler是在主线程即UI线程下的Handler，
即这个Handler是与UI线程下的默认Looper绑定的。Looper是用于实现消息队列和消息循环机制的。
因此，如果是默认创建Handler那么如果线程是做一些耗时操作如网络获取数据等操作，这样创建Handler是不行的.
Android API提供了HandlerThread来创建线程。官网的解释是：Handy class for starting a new thread that has a looper.
The looper can then be used to create handler classes. Note that start() must still be called.</p>

<p>HandlerThread实际上就一个Thread，只不过它比普通的Thread多了一个Looper。</p>

<figure class='code'><figcaption><span>Looper</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HandlerThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
</span><span class='line'> <span class="kd">private</span> <span class="kt">int</span> <span class="n">mPriority</span><span class="o">;</span>
</span><span class='line'> <span class="kd">private</span> <span class="kt">int</span> <span class="n">mTid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'> <span class="kd">private</span> <span class="n">Looper</span> <span class="n">mLooper</span><span class="o">;</span>
</span><span class='line'> <span class="o">....</span>
</span><span class='line'> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
</span><span class='line'>   <span class="n">mTid</span> <span class="o">=</span> <span class="n">Process</span><span class="o">.</span><span class="na">myTid</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">mLooper</span> <span class="o">=</span> <span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">();</span>
</span><span class='line'>            <span class="n">Process</span><span class="o">.</span><span class="na">setThreadPriority</span><span class="o">(</span><span class="n">mPriority</span><span class="o">);</span>
</span><span class='line'>            <span class="n">notifyAll</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">onLooperPrepared</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">mTid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'> <span class="o">}</span>
</span><span class='line'> <span class="o">....</span>
</span><span class='line'> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>创建HandlerThread时要把它启动了，即调用start()方法。然后创建Handler时将HandlerThread中的looper对象传入。
HandlerThread thread = new HandlerThread(&ldquo;MyHandlerThread&rdquo;);
thread.start();
mHandler = new Handler(thread.getLooper());
mHandler.post(new Runnable(){&hellip;});
那么这个Handler对象就是与HandlerThread这个线程绑定了（这时就不再是与UI线程绑定了，这样它处理耗时操作将不会阻塞UI。</p>

<figure class='code'><figcaption><span>Looper</span><a href='http://www.shaojie.name'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="n">HandlerThread</span> <span class="n">mHandlerThread</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mRunning</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="n">Button</span> <span class="n">btn</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">btn</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn</span><span class="o">);</span>
</span><span class='line'>    <span class="n">btn</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mHandlerThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HandlerThread</span><span class="o">(</span><span class="s">&quot;Test&quot;</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
</span><span class='line'>    <span class="n">mHandlerThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">(</span><span class="n">mHandlerThread</span><span class="o">.</span><span class="na">getLooper</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="n">Runnable</span> <span class="n">mRunnable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">while</span> <span class="o">(</span><span class="n">mRunning</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;test HandlerThread...&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">};</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">switch</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn</span> <span class="o">:</span>
</span><span class='line'>        <span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">default</span> <span class="o">:</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mRunning</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="n">mHandler</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mRunning</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mRunning</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    Shao jie


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






		</div>
	</div>
</body>
</html>
